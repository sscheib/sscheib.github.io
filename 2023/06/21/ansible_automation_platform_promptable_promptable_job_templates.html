<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Ansible Automation Platform - Automating the execution of job templates and leveraging the ‘prompt on launch’ feature | Steffen’s random thoughts</title>
<meta name="generator" content="Jekyll v3.9.5">
<meta property="og:title" content="Ansible Automation Platform - Automating the execution of job templates and leveraging the ‘prompt on launch’ feature">
<meta name="author" content="Steffen Scheib">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction">
<meta property="og:description" content="Introduction">
<link rel="canonical" href="https://blog.scheib.me/2023/06/21/ansible_automation_platform_promptable_promptable_job_templates.html">
<meta property="og:url" content="https://blog.scheib.me/2023/06/21/ansible_automation_platform_promptable_promptable_job_templates.html">
<meta property="og:site_name" content="Steffen’s random thoughts">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-06-21T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Ansible Automation Platform - Automating the execution of job templates and leveraging the ‘prompt on launch’ feature">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Steffen Scheib"},"dateModified":"2025-06-17T00:00:00+00:00","datePublished":"2023-06-21T00:00:00+00:00","description":"Introduction","headline":"Ansible Automation Platform - Automating the execution of job templates and leveraging the ‘prompt on launch’ feature","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.scheib.me/2023/06/21/ansible_automation_platform_promptable_promptable_job_templates.html"},"url":"https://blog.scheib.me/2023/06/21/ansible_automation_platform_promptable_promptable_job_templates.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
<link type="application/atom+xml" rel="alternate" href="https://blog.scheib.me/feed.xml" title="Steffen's random thoughts">
</head>
<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Steffen's random thoughts</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">/about</a></div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Ansible Automation Platform - Automating the execution of job templates and leveraging the 'prompt on launch' feature</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-06-21T00:00:00+00:00" itemprop="datePublished">Published: Jun 21, 2023
      </time>
      <time class="dt-modified" datetime="2025-06-17T00:00:00+00:00" itemprop="dateModified">• Last modified: Jun 17, 2025
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Steffen Scheib </span></span>• <span itemprop="readingTime" itemscope><span class="h-card" itemprop="readingTime">

7 minutes to read
</span></span></p>
  </header>

  <div class="toc">
    <h2>Table of contents</h2>
    <ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#ansible-automation-platform-and-the-prompt-on-launch-option">Ansible Automation Platform and the ‘Prompt on launch’ option</a></li>
<li><a href="#magic">Magic</a></li>
<li>
<a href="#change-log">Change log</a><ul>
<li><a href="#2025-06-17">2025-06-17</a></li>
<li><a href="#2024-03-09">2024-03-09</a></li>
</ul>
</li>
</ul>
  </div>
  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="introduction">
  
  
    Introduction <a href="#introduction">#</a>
  
  
</h2>
    

<p>Just today I had an interesting conversation with a customer about the need to <strong>not</strong> duplicate job templates. To quickly give an overview about the problem:</p>

<ul>
  <li>Tens of thousands of hosts split across a numerous amount of locations</li>
  <li>The various locations all required a specific host (e.g. “jump host”) to access the specific location</li>
  <li>End users are making use of Ansible Tower/Ansible Automation Platform and do not know the location or even the names of their servers</li>
</ul>

<p>With Ansible Tower, the customer solved the problem by simply setting a host variable to each and every host that would override the <code class="language-plaintext highlighter-rouge">ssh_extra_args</code> variable for each and
every host so that Ansible would chose the correct jump host magically.</p>

<p>This is no longer possible with Ansible Automation Platform 2.x, as the execution nodes (as the formerly known isolates nodes are now called) no longer receive a connection
via SSH, but via <a href="https://github.com/ansible/receptor">receptor</a> from a controller or hop node (through the <a href="https://www.ansible.com/products/automation-mesh">Automation Mesh</a>).
The most straight forward way to overcome this obstacle is to basically duplicate the job templates as many times as required, but each time assign a new instance group and the
corresponding hosts to it. Either by specifying the <code class="language-plaintext highlighter-rouge">Limit</code> or creating a
<a href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.5/html/using_automation_execution/controller-inventories#ref-controller-smart-inventories">Smart Inventory</a>
that would only contain the hosts that are reachable by the assigned
<a href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.5/html/using_automation_execution/controller-instance-and-container-groups#con-controller-instance-groups">Instance Group</a>.</p>

<p>Unfortunately, this recommendation did not work for the customer, because the requirement of the customer was, that their internal customers do not know where the servers are
located and don’t want to launch multiple Job Templates to achieve one simple task.</p>

<p>Okay, so, but what about
<a href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.5/html/using_automation_execution/controller-workflow-job-templates">Workflow Templates</a>?
Still not good enough, because that still would require multiple Job Templates to be set up to achieve the requirement of “1 Task, 1 Inventory, 1 Job Template”.</p>
<h2 id="ansible-automation-platform-and-the-prompt-on-launch-option">
  
  
    Ansible Automation Platform and the ‘Prompt on launch’ option <a href="#ansible-automation-platform-and-the-prompt-on-launch-option">#</a>
  
  
</h2>
    

<p>Let me introduce you to Ansible Automation Platform’s “prompt able” fields. <img class="emoji" title=":grin:" alt=":grin:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f601.png" height="20" width="20"></p>

<p>First off: This idea is not new, so I didn’t invent it. I just didn’t find a lot of information on how to actually make such a scenario work at scale, so let me describe
the general idea in a bit more detail.</p>

<p>To recap, the requirements at this point are:</p>

<ul>
  <li>One Job- or Workflow Template</li>
  <li>No splitting of Inventories</li>
  <li>Ansible Automation Platform should “know” which Instance Group to use for which host</li>
</ul>

<p>The basic idea is the same as the customer has been doing for years: Add an additional variable to each and every host. With Ansible Tower this used to be the
<code class="language-plaintext highlighter-rouge">ssh_extra_args</code> but since that’s no longer a possibility, let’s think of how Ansible Automation Platform could “know” which Execution Node to use when executing a Job.</p>

<p>The answer is simple: Instance Groups.</p>

<p>The Instance Groups are defined by the customer based on location. For example a data center in Munich, Germany might be named <code class="language-plaintext highlighter-rouge">ig-germany-munich</code>
(<code class="language-plaintext highlighter-rouge">ig</code>: Instance Group). At the time of importing the hosts from their Inventory Source, they would know the location of the server and thus could save the Instance
Group as a variable, e.g. <code class="language-plaintext highlighter-rouge">instance_group: ig-germany-munich</code>.</p>

<p>Now that we have the Instance Group on every host, what can we do with it?</p>

<p>Generally, the idea is to create a ‘generic Job Template’ that would handle all the logic of assigning the correct Instance Group to use when targeting a specific host and
execute the “real” Job Template. I called this Job Template <code class="language-plaintext highlighter-rouge">jt-launch_job</code> - a fitting naming I’d say. <img class="emoji" title=":stuck_out_tongue_winking_eye:" alt=":stuck_out_tongue_winking_eye:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f61c.png" height="20" width="20"></p>

<p>But before we can actually launch the Job and see the magic happen, let me quickly summarize what I have done:</p>

<ol>
  <li>I used Red Hat Satellite as my Inventory Source. In the Satellite, I added a Host Parameter for each host which I called <code class="language-plaintext highlighter-rouge">instance_group</code> and set as value the Instance Group
I’d like to use in Ansible Automation Platform</li>
  <li>I created the corresponding Instance Groups in Ansible Automation Platform</li>
  <li>I set up a Job Template that I’d like to execute on all hosts (with different Instance Groups). In this Job Template I specified the following things:
    <ul>
      <li>The Inventory to use</li>
      <li>The Project to use</li>
      <li>The Credential to use</li>
      <li>I checked <code class="language-plaintext highlighter-rouge">Prompt on launch</code> for both Limit and Instance Groups, but did not specify <strong>any</strong> value</li>
      <li>Last but not least, I checked <code class="language-plaintext highlighter-rouge">Prevent Instance Group Fallback</code> to ensure that Ansible Automation Platform would <strong>not</strong> fall back to any other Instance Group if the
specified one is out of capacity at the moment</li>
    </ul>
  </li>
</ol>
<h2 id="magic">
  
  
    Magic <a href="#magic">#</a>
  
  
</h2>
    

<p>So all that was left now was to create a Job Template with the name <code class="language-plaintext highlighter-rouge">jt-launch_job</code> and write the Ansible code that would make the magic happen. The code I’ve written can be
seen on my <a href="https://github.com/sscheib/ansible-demo-promptable_job_concept">GitHub</a> and is (mostly) straight forward.</p>

<p>I require a <code class="language-plaintext highlighter-rouge">job_template_name</code> to be set (that’s the Job Template where we retrieve the Inventory from and which we will launch multiple times) and a Credential of the type
<a href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.5/html/using_automation_execution/controller-credentials#ref-controller-credential-aap">Red Hat Ansible Automation Platform</a>
to be assigned to the Job Template. This credential provides all the necessary information that we need to access the Controller (Controller Host, Username, Password).</p>

<p>What I do in the playbook is the following:</p>

<ul>
  <li>Ensure both the required variable and the environment variables which we expect from the Credential are set</li>
  <li>Gather information about the Job Template, from which we will extract the Inventory</li>
  <li>We will use the Inventory to determine the actual hosts, that will be targeted</li>
  <li>The most challenging part was to build a dictionary of Instance Groups, of which each one would contain a list of hosts to target. The information was present in the <code class="language-plaintext highlighter-rouge">variables</code>
of the host. You can take look at what I mean in <a href="https://github.com/sscheib/ansible-demo-promptable_job_concept/blob/main/launch_jobs.yml#L52">my code</a>
</li>
  <li>Finally, iterate over that dictionary and launch as many Jobs as required <img class="emoji" title=":slightly_smiling_face:" alt=":slightly_smiling_face:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f642.png" height="20" width="20">
</li>
</ul>

<p>For a better visualization, that dictionary would look something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TASK [debug] ****************************************************************************************************************************************************************************
ok: [localhost] =&gt; {
    "__hosts_instance_groups": {
        "ig-germany-munich": [
            "host1.example.com",
            "host3.example.com",
            "host6.example.com",
            "host4.example.com"
        ],
        "ig-germany-berlin": [
            "host2.example.com",
            "host5.example.com"
        ]
    }
}
</code></pre></div></div>

<p>This would eventually lead to spawning two times the Job Template I had specified. Once with the Instance Group <code class="language-plaintext highlighter-rouge">ig-germany-munich</code> and the hosts <code class="language-plaintext highlighter-rouge">host1, host3, host6, host4</code>
and the other time with the Instance Group <code class="language-plaintext highlighter-rouge">ig-germany-berlin</code> and the hosts <code class="language-plaintext highlighter-rouge">host2, host5</code>.</p>

<p>That’s already it - I hope it is useful for someone! <img class="emoji" title=":slightly_smiling_face:" alt=":slightly_smiling_face:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f642.png" height="20" width="20"></p>
<h2 id="change-log">
  
  
    Change log <a href="#change-log">#</a>
  
  
</h2>
    
<h3 id="2025-06-17">
  
  
    2025-06-17 <a href="#2025-06-17">#</a>
  
  
</h3>
    

<ul>
  <li>Fixing broken links and correcting a few typos</li>
</ul>
<h3 id="2024-03-09">
  
  
    2024-03-09 <a href="#2024-03-09">#</a>
  
  
</h3>
    

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">markdownlint</code> fixes</li>
</ul>

  </div>

  <script src="https://utteranc.es/client.js" repo="sscheib/sscheib.github.io-comments" issue-term="title" label="comment" theme="github-light" crossorigin="anonymous" async>
  </script>

  <a class="u-url" href="/2023/06/21/ansible_automation_platform_promptable_promptable_job_templates.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://blog.scheib.me/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          
        </ul>
      </div>
      <div class="footer-col">
        <p>This my personal blog, where I post about things that I do and find interesting. All posts and thoughts on this blog are solely my opinion and are not related to my employer.</p>
      </div>
    </div>

    <div class="social-links">
<ul class="social-media-list"><li><a href="https://github.com/sscheib"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sscheib</span></a></li></ul>
</div>
    <div class="datenschutzerklaerung">
    <a style="font-size:10px" href="https://blog.scheib.me/datenschutzerklaerung.html">Datenschutzerklärung</a> <a style="font-size:10px" href="https://blog.scheib.me/impressum.html">Impressum</a>
    </div>

  </div>
</footer>
</body>

</html>
